{"version":3,"sources":["js/facility.js"],"names":["channel","intFromFindClass","parent","className","parseInt","find","html","getAvailable","row","getQuantity","getCost","getCredits","parents","getType","data","setUserQuantity","newQuantity","setTotalQuantity","setCredits","fn","handlers","credits","cost","push","id","quantity","type","currentQuantity","$","on","el","target","currentTarget","payload","each","$html","existing","first","length","remove","append"],"mappings":"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","file":"../priv/static/js/facility.js","sourcesContent":["export default function(channel){\n  const intFromFindClass = (parent, className) => parseInt(parent.find(className).html(), 10)\n  const getAvailable     = (row) => intFromFindClass(row, '.js-available-quantity')\n  const getQuantity      = (row) => intFromFindClass(row, '.js-current-quantity')\n  const getCost          = (row) => intFromFindClass(row, '.js-credit-cost')\n  const getCredits       = (row) => intFromFindClass(row.parents('.js-stock-type'), '.js-credit-count')\n  const getType          = (row) => row.parents('.js-stock-type').find('.js-credit-count').data('credit-type')\n  const setUserQuantity  = (row, newQuantity) => row.find('.js-current-quantity').html(newQuantity)\n  const setTotalQuantity = (row, newQuantity) => row.find('.js-available-quantity').html(newQuantity)\n  const setCredits       = (row, newQuantity) => row.parents('.js-stock-type').find('.js-credit-count').html(newQuantity)\n  var fn;\n  let handlers = {\n    \"js-add-stock\": function(row){\n      const credits = getCredits(row);\n      const cost    = getCost(row);\n      if (getAvailable(row) > 0 && credits >= cost) {\n        channel.push('request_stock', { id: row.data('stock-id'), quantity: 1, type: getType(row) });\n        setUserQuantity(row, getQuantity(row) + 1);\n        setCredits(row, credits - cost);\n      }\n    },\n    \"js-remove-stock\": function(row){\n      const currentQuantity = getQuantity(row)\n      if (currentQuantity > 0) {\n        const credits = getCredits(row);\n        const cost    = getCost(row);\n        channel.push('release_stock', { id: row.data('stock-id'), quantity: 1, type: getType(row) });\n        setUserQuantity(row, currentQuantity - 1);\n        setCredits(row, credits + cost);\n      }\n    },\n    \"js-clear-stock\": function(row){\n      const currentQuantity = getQuantity(row)\n      if (currentQuantity > 0) {\n        const credits = getCredits(row);\n        const cost    = getCost(row);\n        channel.push('release_stock', { id: row.data('stock-id'), quantity: getQuantity(row), type: getType(row) });\n        setUserQuantity(row, 0)\n        setCredits(row, credits + cost * currentQuantity);\n      }\n    }\n  }\n\n\n  $('.js-stock-row').on('click', function(el){\n    if (fn = handlers[el.target.className]){\n      fn($(el.currentTarget));\n    };\n  })\n\n  channel.on('set_stock', payload => {\n    const {id, quantity} = payload;\n    setTotalQuantity($(`*[data-stock-id=\"${id}\"]`), quantity);\n  });\n\n  channel.on('current_credits', payload => {\n    $.each(payload, (type, credits) => $(`#${type}`).find('.js-credit-count').html(credits) )\n  });\n\n  channel.on('update_distribution', payload => {\n    const {id, html} = payload;\n    const $html = $(html)\n    const existing = $('.js-cart').find(`*[data-stock-distribution-id=\"${id}\"]`).first();\n    const quantity = intFromFindClass($html, '.js-quantity-requested')\n\n    if (existing.length && quantity > 0) {\n      $(existing).html($html.html())\n    } else if (existing.length && quantity == 0) {\n      $(existing).remove()\n    } else {\n      $('.js-cart').find('tbody').append(html)\n    }\n  });\n\n}"]}